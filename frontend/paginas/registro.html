<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Registro - Sistema de Gestión de Eventos</title>
	<link rel="stylesheet" href="../estilos/global.css">
	<link rel="stylesheet" href="../estilos/componentes.css">
</head>
<body>
	<div id="headerContainer"></div>

	<div class="contenedor-estrecho" style="padding: 80px 24px;">
		<div class="tarjeta">
			<h1 class="text-center">Crear Cuenta</h1>
			<p class="text-center mb-xl">Regístrate para comprar boletos y gestionar tus eventos</p>

			<form id="registroForm">
				<div class="grid grid-2">
					<div class="form-grupo">
						<label class="form-label" for="nombre">Nombre</label>
						<input type="text" id="nombre" class="form-input" required>
					</div>

					<div class="form-grupo">
						<label class="form-label" for="apellido">Apellido</label>
						<input type="text" id="apellido" class="form-input" required>
					</div>
				</div>

				<div class="form-grupo">
					<label class="form-label" for="email">Correo Electrónico</label>
					<input type="email" id="email" class="form-input" required>
				</div>

				<div class="form-grupo">
					<label class="form-label" for="telefono">Teléfono (opcional)</label>
					<input type="tel" id="telefono" class="form-input">
				</div>

				<div class="form-grupo">
					<label class="form-label" for="password">Contraseña</label>
					<input type="password" id="password" class="form-input" required minlength="6">
					<span class="form-helper">Mínimo 6 caracteres</span>
				</div>

				<div class="form-grupo">
					<label class="form-label" for="passwordConfirm">Confirmar Contraseña</label>
					<input type="password" id="passwordConfirm" class="form-input" required>
				</div>

				<div class="form-grupo">
					<label class="form-label" for="userType">Tipo de Usuario</label>
					<select id="userType" class="form-input" required>
						<option value="asistente">Asistente</option>
						<option value="organizador">Organizador</option>
						<option value="taquilla">Taquilla</option>
						<option value="administrador">Administrador</option>
					</select>
				</div>


				<div id="errorMensaje" class="alerta alerta-error oculto"></div>

				<button type="submit" class="btn btn-primario btn-block btn-lg" id="btnRegistro">
					Crear Cuenta
				</button>
			</form>

			<p class="text-center mt-lg">
				¿Ya tienes cuenta? <a href="./login.html">Inicia sesión aquí</a>
			</p>
		</div>
	</div>

	<div id="footerContainer"></div>

	<script src="../scripts/config.js"></script>
	<script src="../scripts/api-cliente.js"></script>
	<script src="../scripts/auth.js"></script>
	<script src="../scripts/utilidades.js"></script>
	<script src="../scripts/header.js"></script>
	<script>
		// Cargar componentes
		fetch('../componentes/header.html').then(r => r.text()).then(h => document.getElementById('headerContainer').innerHTML = h);
		fetch('../componentes/footer.html').then(r => r.text()).then(h => document.getElementById('footerContainer').innerHTML = h);

		// Si ya está autenticado, redirigir
		if (Auth.estaAutenticado()) {
			window.location.href = './index.html';
		}

		// Manejar formulario
		document.getElementById('registroForm').addEventListener('submit', async (e) => {
			e.preventDefault();

			const nombre = document.getElementById('nombre').value;
			const apellido = document.getElementById('apellido').value;
			const email = document.getElementById('email').value;
			const telefono = document.getElementById('telefono').value;
			const password = document.getElementById('password').value;
			const passwordConfirm = document.getElementById('passwordConfirm').value;
			const rol = document.getElementById('userType').value;
			const btnRegistro = document.getElementById('btnRegistro');
			const errorDiv = document.getElementById('errorMensaje');

			// Ocultar error previo
			errorDiv.classList.add('oculto');

			// Validar contraseñas
			if (password !== passwordConfirm) {
				errorDiv.textContent = 'Las contraseñas no coinciden';
				errorDiv.classList.remove('oculto');
				return;
			}

			// Validar rol
			const rolesValidos = ['asistente', 'organizador', 'taquilla', 'administrador'];
			if (!rolesValidos.includes(rol)) {
				errorDiv.textContent = 'Tipo de usuario no válido';
				errorDiv.classList.remove('oculto');
				return;
			}

			// Deshabilitar botón
			btnRegistro.disabled = true;
			btnRegistro.textContent = 'Creando cuenta...';

			try {
				await Auth.registrar({
					nombre,
					apellido,
					email,
					telefono,
					password,
					rol
				});

				mostrarToast('Cuenta creada exitosamente', 'exito');
				setTimeout(() => {
					window.location.href = './index.html';
				}, 1000);
			} catch (error) {
				errorDiv.textContent = error.message || 'Error al crear la cuenta';
				errorDiv.classList.remove('oculto');
				btnRegistro.disabled = false;
				btnRegistro.textContent = 'Crear Cuenta';
			}
		});
	</script>
</body>
</html>

