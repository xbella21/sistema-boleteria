<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Iniciar Sesión - Sistema de Gestión de Eventos</title>
	<link rel="stylesheet" href="../estilos/global.css">
	<link rel="stylesheet" href="../estilos/componentes.css">
</head>
<body>
	<div id="headerContainer"></div>

	<div class="contenedor-estrecho" style="padding: 80px 24px;">
		<div class="tarjeta">
			<h1 class="text-center">Iniciar Sesión</h1>
			<p class="text-center mb-xl">Accede a tu cuenta para gestionar eventos y boletos</p>

			<form id="loginForm">
				<div class="form-grupo">
					<label class="form-label" for="email">Correo Electrónico</label>
					<input type="email" id="email" class="form-input" required>
				</div>

				<div class="form-grupo">
					<label class="form-label" for="password">Contraseña</label>
					<input type="password" id="password" class="form-input" required>
				</div>

				<div id="errorMensaje" class="alerta alerta-error oculto"></div>

				<button type="submit" class="btn btn-primario btn-block btn-lg" id="btnLogin">
					Iniciar Sesión
				</button>
			</form>

			<p class="text-center mt-lg">
				¿No tienes cuenta? <a href="./registro.html">Regístrate aquí</a>
			</p>
		</div>
	</div>

	<div id="footerContainer"></div>

	<script src="../scripts/config.js"></script>
	<script src="../scripts/api-cliente.js"></script>
	<script src="../scripts/auth.js"></script>
	<script src="../scripts/utilidades.js"></script>
	<script>
		// Cargar componentes
		fetch('../componentes/header.html').then(r => r.text()).then(h => document.getElementById('headerContainer').innerHTML = h);
		fetch('../componentes/footer.html').then(r => r.text()).then(h => document.getElementById('footerContainer').innerHTML = h);

		// Si ya está autenticado, redirigir
		if (Auth.estaAutenticado()) {
			window.location.href = './index.html';
		}

		// Manejar formulario
		document.getElementById('loginForm').addEventListener('submit', async (e) => {
			e.preventDefault();

			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;
			const btnLogin = document.getElementById('btnLogin');
			const errorDiv = document.getElementById('errorMensaje');

			// Ocultar error previo
			errorDiv.classList.add('oculto');

			// Deshabilitar botón
			btnLogin.disabled = true;
			btnLogin.textContent = 'Iniciando sesión...';

			try {
				await Auth.login(email, password);
				mostrarToast('Inicio de sesión exitoso', 'exito');
				
				// Redirigir según rol
				const usuario = Auth.obtenerUsuario();
				setTimeout(() => {
					if (usuario.rol === CONFIG.ROLES.ADMINISTRADOR) {
						window.location.href = './admin/dashboard.html';
					} else if (usuario.rol === CONFIG.ROLES.ORGANIZADOR) {
						window.location.href = './organizador/eventos.html';
					} else if (usuario.rol === CONFIG.ROLES.TAQUILLA) {
						window.location.href = './taquilla/scanner.html';
					} else {
						window.location.href = './index.html';
					}
				}, 1000);
			} catch (error) {
				errorDiv.textContent = error.message || 'Error al iniciar sesión';
				errorDiv.classList.remove('oculto');
				btnLogin.disabled = false;
				btnLogin.textContent = 'Iniciar Sesión';
			}
		});
	</script>
</body>
</html>

